<!DOCTYPE html>
<html>
<head>
  <title>VocalEyes</title>
  <link rel="stylesheet" href="style.css">
  <script src="jquery.min.js"></script>
  <script>
    $(document).ready(function() {
      // vars

      var wordBuilder = "";
      var sentenceBuilder = "";
      var sentenceLog = [];

      // VocalEyes Functions
      var appendWordToSentenceBuilder = function() {
        sentenceBuilder += wordBuilder + " ";
        wordBuilder = "";
      }

      var appendPunctToSentenceBuilder = function(punct) {
          // change to eliminate all trailing whitespace
      }

      var VE_RandomText = function(length) {
        var text = "";
        var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        for(var i = 0; i < length; i++)
          text += possible.charAt(Math.floor(Math.random() * possible.length));

        return text;
      }

      var VE_TTSSentenceBuilder = function() {
        var url = "http://www.translate.google.com/translate_tts?tl=en&q=" + sentenceBuilder;
        var id = "audio-" + VE_RandomText(5);
        $("body").append("<audio autoplay id='" + id + "'><source src='" + url + "' type='audio/mpeg'></audio>");
        $("#" + id).on('ended', function() {
          $("#" + id).remove();
        });
      }

      // VocalEyes Classes
      var VE_KeyValPair = function(key, val) {
        this.class = "VE_KeyValPair";
        this.key = key;
        this.val = val;
      }

      var VE_DecisionNode = function(kvPairs) {
        this.class = "VE_DecisionNode";
        this.decisions = kvPairs;
      }

      var VE_Punctuation = function(char, endSentence) {
        this.class = "VE_Punctuation";
        this.char = char;
        this.endSentence = endSentence;
      }

      var alpha = new VE_DecisionNode([]); // alpha is an empty Decision

      var aNode = new VE_DecisionNode([
        new VE_KeyValPair('a','a'),
        new VE_KeyValPair('b','b'),
        new VE_KeyValPair('c','c'),
        new VE_KeyValPair('d','d'),
        new VE_KeyValPair('back',alpha)
      ]);

      var eNode = new VE_DecisionNode([
        new VE_KeyValPair('e','e'),
        new VE_KeyValPair('f','f'),
        new VE_KeyValPair('g','g'),
        new VE_KeyValPair('h','h'),
        new VE_KeyValPair('back',alpha)
      ]);

      var iNode = new VE_DecisionNode([
        new VE_KeyValPair('i','i'),
        new VE_KeyValPair('j','j'),
        new VE_KeyValPair('k','k'),
        new VE_KeyValPair('l','l'),
        new VE_KeyValPair('m','m'),
        new VE_KeyValPair('n','n'),
        new VE_KeyValPair('back',alpha)
      ]);

      var oNode = new VE_DecisionNode([
        new VE_KeyValPair('o','o'),
        new VE_KeyValPair('p','p'),
        new VE_KeyValPair('q','q'),
        new VE_KeyValPair('r','r'),
        new VE_KeyValPair('s','s'),
        new VE_KeyValPair('t','t'),
        new VE_KeyValPair('back',alpha)
      ]);

      var uNode = new VE_DecisionNode([
        new VE_KeyValPair('u','u'),
        new VE_KeyValPair('v','v'),
        new VE_KeyValPair('w','w'),
        new VE_KeyValPair('x','x'),
        new VE_KeyValPair('y','y'),
        new VE_KeyValPair('z','z'),
        new VE_KeyValPair('back',alpha)
      ]);

      var punctNode = new VE_DecisionNode([
        new VE_KeyValPair('.', new VE_Punctuation('.', true)),
        new VE_KeyValPair(',', new VE_Punctuation(',', false)),
        new VE_KeyValPair('?', new VE_Punctuation('?', true)),
        new VE_KeyValPair('!', new VE_Punctuation('!', true)),
        new VE_KeyValPair('back',alpha)
      ]);

      var functNode = new VE_DecisionNode([
        new VE_KeyValPair('say', VE_TTSSentenceBuilder),
        new VE_KeyValPair('back',alpha)
      ]);

      alpha.decisions.push(new VE_KeyValPair('a',aNode));
      alpha.decisions.push(new VE_KeyValPair('e',eNode));
      alpha.decisions.push(new VE_KeyValPair('i',iNode));
      alpha.decisions.push(new VE_KeyValPair('o',oNode));
      alpha.decisions.push(new VE_KeyValPair('u',uNode));
      alpha.decisions.push(new VE_KeyValPair('_',appendWordToSentenceBuilder));
      alpha.decisions.push(new VE_KeyValPair('!',punctNode));
      alpha.decisions.push(new VE_KeyValPair('<',functNode));
      
      var currNode = alpha;
      var valueCounter = 0;

      var inputEvent = function() {
        console.log("input detected!");
        var selectedDecision = currNode.decisions[valueCounter];
        var selectedValue = selectedDecision.val;
        switch(typeof selectedValue) {
          case "string":
            wordBuilder += selectedValue;
            currNode = alpha;
            console.log(wordBuilder);
            break;

          case "object":
            switch(selectedValue.class) {
              case "VE_DecisionNode":
                currNode = selectedValue;
                console.log(selectedValue);
                break;
              case "VE_Punctuation":
                console.log("punctuation ALMOST happened ...");
              default:
                console.log("Somebody is feeling pretty damn lazy.");
            }
            break;

          case "function":
            selectedValue();
            break;

          default:
            console.log("something went terribly wrong!");
        }
        
        valueCounter = 0;
        updateInterface();
      };

      // listeners
      $('body').keypress(function(e) {
        if(e.which == 32) { // space
          inputEvent();
        }
      });

      var updateInterface = function() {
        // update decisions interface
        var userInterfaceContents = "";
        for (var i = currNode.decisions.length - 1; i >= 0; i--) {
          userInterfaceContents = "<td>" + currNode.decisions[i].key + "</td>" + userInterfaceContents;
        };

        $("#interface").html("<tr>" + userInterfaceContents + "</tr>");
        $("#interface tr:first td:nth-child(" + (valueCounter + 1) + ")").css({"font-size": "40px", "background": "green", "color": "white", "text-shadow": "0px 0px 0px #000"});

        // update word builder
        $("#word-builder").html(wordBuilder);

        // update sentence builder
        $("#sentence-builder").html(sentenceBuilder);
      };

      setInterval(function() {
        valueCounter = (valueCounter + 1) % currNode.decisions.length;

        console.log(currNode);
        console.log(valueCounter);

        updateInterface();
      }, 800);   
    });
  </script>
</head>
<body>
<div class="container">
  <h1>VocalEyes</h1>

  <hr>
  <h3>Interface 0.2</h3>
  <ol>
    <li>Use the spacebar to select a group of characters.</li>
    <li>Select _ to add the word in the Word Builder to the Sentence Builder.</li>
    <li>The Sentence Builder inserts spaces between words.</li>
  </ol>
  <table id="interface">
  </table>

  <hr>
  <h3>Word Builder</h3> 
  <p id="word-builder"></p>

  <hr>
  <h3>Sentence Builder</h3>
  <p id="sentence-builder"></p>

  <hr>
  <h3>Sentence Log</h3>
  <table id="sentence-log"></table>

  <footer><small>an apiarygroup project</small></footer>
</div>

</body>
</html>